<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Happysearch</title>
    <style>
      :root {
        --bg: #f5faff;
        --text: #1f2937;
        --muted: #64748b;
        --line: #d7e9ff;
        --brand: #7cc4ff;
        --brand-dark: #54afff;
        --btn-bg: #eef6ff;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
        color: var(--text);
        background: var(--bg);
      }

      .page {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .center {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }

      .search-shell {
        width: min(760px, 100%);
      }

      .logo {
        text-align: center;
        font-size: clamp(56px, 11vw, 94px);
        font-weight: 700;
        letter-spacing: -0.02em;
        color: var(--brand);
        margin-bottom: 22px;
        user-select: none;
      }

      .logo span { color: var(--brand-dark); }

      .search-wrap {
        border: 1px solid var(--line);
        background: #fff;
        border-radius: 999px;
        padding: 6px 8px 6px 18px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 10px rgba(66, 153, 225, 0.08);
      }

      .search-wrap:focus-within {
        border-color: var(--brand);
        box-shadow: 0 4px 16px rgba(66, 153, 225, 0.22);
      }

      input[type="search"] {
        flex: 1;
        border: 0;
        outline: none;
        font-size: 18px;
        padding: 10px 4px;
        color: var(--text);
      }

      .search-icon {
        color: var(--muted);
        font-size: 15px;
      }

      .actions {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      button {
        border: 1px solid var(--line);
        background: var(--btn-bg);
        color: #2563eb;
        border-radius: 8px;
        padding: 10px 16px;
        font-size: 14px;
        cursor: pointer;
      }

      button:hover {
        border-color: #b5d9ff;
        background: #e6f2ff;
      }

      .results {
        width: min(860px, 100%);
        margin: 30px auto 40px;
        padding: 0 24px;
        display: none;
      }

      .meta {
        color: var(--muted);
        margin-bottom: 14px;
      }

      .result {
        background: #fff;
        border: 1px solid #e4f0ff;
        border-radius: 12px;
        padding: 14px 16px;
        margin-bottom: 10px;
      }

      .result a {
        color: #1d4ed8;
        font-size: 20px;
        text-decoration: none;
      }

      .result a:hover { text-decoration: underline; }

      .result p {
        margin: 7px 0;
        line-height: 1.45;
      }

      .url {
        color: #0f766e;
        font-size: 13px;
        word-break: break-word;
      }

      footer {
        text-align: center;
        color: var(--muted);
        font-size: 12px;
        padding: 16px;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <main class="center">
        <section class="search-shell">
          <div class="logo">Happy<span>search</span></div>
          <form id="searchForm">
            <div class="search-wrap">
              <span class="search-icon">ðŸ”Ž</span>
              <input id="query" type="search" name="q" placeholder="Search Happysearch" autocomplete="off" required />
            </div>
            <div class="actions">
              <button type="submit">Happy Search</button>
              <button id="luckyBtn" type="button">I'm Feeling Happy</button>
            </div>
          </form>
        </section>
      </main>

      <section id="results" class="results">
        <div id="meta" class="meta"></div>
        <div id="list"></div>
      </section>

      <footer>Happysearch â€¢ the light-blue friendly search page</footer>
    </div>

    <script>
      const form = document.getElementById('searchForm');
      const queryInput = document.getElementById('query');
      const luckyBtn = document.getElementById('luckyBtn');
      const results = document.getElementById('results');
      const meta = document.getElementById('meta');
      const list = document.getElementById('list');

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function renderResults(payload) {
        list.innerHTML = '';
        results.style.display = 'block';

        const total = payload.results.length;
        meta.textContent = `${total} result${total === 1 ? '' : 's'} in ${payload.elapsed_ms} ms`;

        if (!total) {
          list.innerHTML = '<div class="result"><p>No results found.</p></div>';
          return;
        }

        payload.results.forEach((item) => {
          const article = document.createElement('article');
          article.className = 'result';
          article.innerHTML = `
            <a href="${escapeHtml(item.url)}" target="_blank" rel="noreferrer">${escapeHtml(item.title)}</a>
            <p>${escapeHtml(item.snippet || 'No description available.')}</p>
            <div class="url">${escapeHtml(item.url)}</div>
          `;
          list.appendChild(article);
        });
      }

      async function runSearch() {
        const q = queryInput.value.trim();
        if (!q) return null;

        meta.textContent = 'Searching...';
        list.innerHTML = '';
        results.style.display = 'block';

        const response = await fetch(`/api/search?q=${encodeURIComponent(q)}`);
        const payload = await response.json();
        if (!response.ok) {
          throw new Error(payload.error || 'Search failed.');
        }
        renderResults(payload);
        return payload;
      }

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        try {
          await runSearch();
        } catch (error) {
          meta.textContent = error.message;
          list.innerHTML = '';
        }
      });

      luckyBtn.addEventListener('click', async () => {
        try {
          const payload = await runSearch();
          if (payload && payload.results.length > 0) {
            window.open(payload.results[0].url, '_blank', 'noopener,noreferrer');
          }
        } catch (error) {
          meta.textContent = error.message;
        }
      });
    </script>
  </body>
</html>

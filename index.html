<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Happysearch</title>
    <style>
      :root {
        --bg: #ffffff;
        --text: #202124;
        --muted: #5f6368;
        --line: #dfe1e5;
        --line-strong: #d2d5da;
        --brand-light: #7ec3ff;
        --brand-dark: #3ba6ff;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
        color: var(--text);
        background: var(--bg);
      }

      .page {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .center {
        flex: 1;
        display: grid;
        place-items: center;
        padding: 24px;
      }

      .search-shell {
        width: min(584px, 100%);
      }

      .logo {
        text-align: center;
        font-size: clamp(54px, 12vw, 90px);
        font-weight: 700;
        letter-spacing: -0.02em;
        color: var(--brand-light);
        margin-bottom: 24px;
        user-select: none;
      }

      .logo span {
        color: var(--brand-dark);
      }

      .search-wrap {
        border: 1px solid var(--line);
        background: #fff;
        border-radius: 24px;
        padding: 0 14px;
        display: flex;
        align-items: center;
        gap: 10px;
        min-height: 46px;
      }

      .search-wrap:hover,
      .search-wrap:focus-within {
        border-color: var(--line-strong);
        box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
      }

      .search-icon {
        color: #9aa0a6;
        font-size: 14px;
      }

      input[type='search'] {
        flex: 1;
        border: 0;
        outline: none;
        font-size: 16px;
        color: var(--text);
        background: transparent;
      }

      .actions {
        margin-top: 30px;
        display: flex;
        justify-content: center;
      }

      button {
        border: 1px solid #f8f9fa;
        background: #f8f9fa;
        color: #3c4043;
        border-radius: 4px;
        padding: 0 16px;
        height: 36px;
        font-size: 14px;
        cursor: pointer;
      }

      button:hover {
        border-color: #dadce0;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
      }

      .results {
        width: min(760px, 100%);
        margin: 18px auto 40px;
        padding: 0 24px;
        display: none;
      }

      .meta {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }

      .result {
        margin-bottom: 24px;
      }

      .result a {
        color: #1a0dab;
        font-size: 20px;
        text-decoration: none;
      }

      .result a:hover {
        text-decoration: underline;
      }

      .result p {
        margin: 4px 0 0;
        color: #4d5156;
        line-height: 1.45;
      }

      .url {
        color: #006621;
        font-size: 14px;
        margin-top: 2px;
        word-break: break-word;
      }

      footer {
        text-align: center;
        color: var(--muted);
        font-size: 12px;
        padding: 16px;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <main class="center">
        <section class="search-shell">
          <div class="logo">Happy<span>search</span></div>
          <form id="searchForm">
            <div class="search-wrap">
              <span class="search-icon">ðŸ”Ž</span>
              <input id="query" type="search" name="q" placeholder="Search Happysearch" autocomplete="off" required />
            </div>
            <div class="actions">
              <button type="submit">Happy Search</button>
            </div>
          </form>
        </section>
      </main>

      <section id="results" class="results">
        <div id="meta" class="meta"></div>
        <div id="list"></div>
      </section>

      <footer>Happysearch</footer>
    </div>

    <script>
      const form = document.getElementById('searchForm');
      const queryInput = document.getElementById('query');
      const results = document.getElementById('results');
      const meta = document.getElementById('meta');
      const list = document.getElementById('list');

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function renderResults(payload) {
        list.innerHTML = '';
        results.style.display = 'block';

        const total = payload.results.length;
        meta.textContent = `About ${total} result${total === 1 ? '' : 's'} (${payload.elapsed_ms} ms)`;

        if (!total) {
          list.innerHTML = '<div class="result"><p>No results found.</p></div>';
          return;
        }

        payload.results.forEach((item) => {
          const article = document.createElement('article');
          article.className = 'result';
          article.innerHTML = `
            <a href="${escapeHtml(item.url)}" target="_blank" rel="noreferrer">${escapeHtml(item.title)}</a>
            <div class="url">${escapeHtml(item.url)}</div>
            <p>${escapeHtml(item.snippet || 'No description available.')}</p>
          `;
          list.appendChild(article);
        });
      }

      async function runSearch() {
        const q = queryInput.value.trim();
        if (!q) return;

        meta.textContent = 'Searching...';
        list.innerHTML = '';
        results.style.display = 'block';

        const response = await fetch(`/api/search?q=${encodeURIComponent(q)}`);
        const raw = await response.text();

        let payload;
        try {
          payload = JSON.parse(raw);
        } catch (_error) {
          throw new Error('Search failed: server returned invalid JSON.');
        }

        if (!response.ok) {
          throw new Error(payload.error || 'Search failed.');
        }

        renderResults(payload);
      }

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        try {
          await runSearch();
        } catch (error) {
          meta.textContent = error.message;
          list.innerHTML = '';
        }
      });
    </script>
  </body>
</html>
